{% extends "web_page/layout.html" %}
{% load static %}

{% block body %}
<div class="container">
    <h2 class="my-4 unselectable">Садржај</h2>
    
    <!-- Search Bar -->
    <div class="mb-4">
        <input type="text" id="bookSearch" class="form-control" placeholder="Претражите садржај...">
    </div>
    
    <div class="bible-table-container">
        <!-- Old Testament -->
        <h3 class="mt-5 mb-3 unselectable">Књиге Старога завјета</h3>
        
        <!-- Law Books -->
        <h4 class="mt-4 mb-3 unselectable">Законске књиге</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" style="width: 60px" class="unselectable">Бр.</th>
                        <th scope="col" style="width: 100px" class="unselectable">Скраћеница</th>
                        <th scope="col" class="unselectable">Назив</th>
                        <th scope="col" style="width: 80px"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        {% if book.id >= 1 and book.id <= 5 %}
                        <tr>
                            <th scope="row" class="unselectable">{{ forloop.counter }}</th>
                            <td class="text-nowrap">{{ book.acronym }}</td>
                            <td>{{ book.title }}</td>
                            <td class="text-center"><a href="{% url 'show_book' book_id=book.id %}" class="btn btn-sm btn-outline-primary"><i class='fas fa-book-medical'></i></a></td>          
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Historical Books -->
        <h4 class="mt-4 mb-3 unselectable">Историјске књиге</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" style="width: 60px" class="unselectable">Бр.</th>
                        <th scope="col" style="width: 100px" class="unselectable">Скраћеница</th>
                        <th scope="col" class="unselectable">Назив</th>
                        <th scope="col" style="width: 80px"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        {% if book.id >= 6 and book.id <= 23 %}
                        <tr>
                            <th scope="row" class="unselectable">{{ forloop.counter }}</th>
                            <td class="text-nowrap">{{ book.acronym }}</td>
                            <td>{{ book.title }}</td>
                            <td class="text-center"><a href="{% url 'show_book' book_id=book.id %}" class="btn btn-sm btn-outline-primary"><i class='fas fa-book-medical'></i></a></td>          
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Wisdom Books -->
        <h4 class="mt-4 mb-3 unselectable">Поучне књиге</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" style="width: 60px" class="unselectable">Бр.</th>
                        <th scope="col" style="width: 100px" class="unselectable">Скраћеница</th>
                        <th scope="col" class="unselectable">Назив</th>
                        <th scope="col" style="width: 80px"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        {% if book.id >= 24 and book.id <= 30 %}
                        <tr>
                            <th scope="row" class="unselectable">{{ forloop.counter }}</th>
                            <td class="text-nowrap">{{ book.acronym }}</td>
                            <td>{{ book.title }}</td>
                            <td class="text-center"><a href="{% url 'show_book' book_id=book.id %}" class="btn btn-sm btn-outline-primary"><i class='fas fa-book-medical'></i></a></td>          
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Major Prophets -->
        <h4 class="mt-4 mb-3 unselectable">Пророчке књиге великих пророка</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" style="width: 60px" class="unselectable">Бр.</th>
                        <th scope="col" style="width: 100px" class="unselectable">Скраћеница</th>
                        <th scope="col" class="unselectable">Назив</th>
                        <th scope="col" style="width: 80px"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        {% if book.id >= 31 and book.id <= 37 %}
                        <tr>
                            <th scope="row" class="unselectable">{{ forloop.counter }}</th>
                            <td class="text-nowrap">{{ book.acronym }}</td>
                            <td>{{ book.title }}</td>
                            <td class="text-center"><a href="{% url 'show_book' book_id=book.id %}" class="btn btn-sm btn-outline-primary"><i class='fas fa-book-medical'></i></a></td>          
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Minor Prophets -->
        <h4 class="mt-4 mb-3 unselectable">Пророчке књиге малих пророка</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" style="width: 60px" class="unselectable">Бр.</th>
                        <th scope="col" style="width: 100px" class="unselectable">Скраћеница</th>
                        <th scope="col" class="unselectable">Назив</th>
                        <th scope="col" style="width: 80px"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        {% if book.id >= 38 and book.id <= 49 %}
                        <tr>
                            <th scope="row" class="unselectable">{{ forloop.counter }}</th>
                            <td class="text-nowrap">{{ book.acronym }}</td>
                            <td>{{ book.title }}</td>
                            <td class="text-center"><a href="{% url 'show_book' book_id=book.id %}" class="btn btn-sm btn-outline-primary"><i class='fas fa-book-medical'></i></a></td>          
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- New Testament -->
        <h3 class="mt-5 mb-3 unselectable">Књиге Новога завјета</h3>
        
        <!-- Gospels -->
        <h4 class="mt-4 mb-3 unselectable">Свето јеванђеље</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" style="width: 60px" class="unselectable">Бр.</th>
                        <th scope="col" style="width: 100px" class="unselectable">Скраћеница</th>
                        <th scope="col" class="unselectable">Назив</th>
                        <th scope="col" style="width: 80px"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        {% if book.id >= 50 and book.id <= 53 %}
                        <tr>
                            <th scope="row" class="unselectable">{{ forloop.counter }}</th>
                            <td class="text-nowrap">{{ book.acronym }}</td>
                            <td>{{ book.title }}</td>
                            <td class="text-center"><a href="{% url 'show_book' book_id=book.id %}" class="btn btn-sm btn-outline-primary"><i class='fas fa-book-medical'></i></a></td>          
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Historical Book -->
        <h4 class="mt-4 mb-3 unselectable">Историјска књига</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" style="width: 60px" class="unselectable">Бр.</th>
                        <th scope="col" style="width: 100px" class="unselectable">Скраћеница</th>
                        <th scope="col" class="unselectable">Назив</th>
                        <th scope="col" style="width: 80px"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        {% if book.id == 54 %}
                        <tr>
                            <th scope="row" class="unselectable">{{ forloop.counter }}</th>
                            <td class="text-nowrap">{{ book.acronym }}</td>
                            <td>{{ book.title }}</td>
                            <td class="text-center"><a href="{% url 'show_book' book_id=book.id %}" class="btn btn-sm btn-outline-primary"><i class='fas fa-book-medical'></i></a></td>          
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pauline Epistles -->
        <h4 class="mt-4 mb-3 unselectable">Посланице светог апостола Павла</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" style="width: 60px" class="unselectable">Бр.</th>
                        <th scope="col" style="width: 100px" class="unselectable">Скраћеница</th>
                        <th scope="col" class="unselectable">Назив</th>
                        <th scope="col" style="width: 80px"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        {% if book.id >= 55 and book.id <= 68 %}
                        <tr>
                            <th scope="row" class="unselectable">{{ forloop.counter }}</th>
                            <td class="text-nowrap">{{ book.acronym }}</td>
                            <td>{{ book.title }}</td>
                            <td class="text-center"><a href="{% url 'show_book' book_id=book.id %}" class="btn btn-sm btn-outline-primary"><i class='fas fa-book-medical'></i></a></td>          
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- General Epistles -->
        <h4 class="mt-4 mb-3 unselectable">Саборне посланице</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" style="width: 60px" class="unselectable">Бр.</th>
                        <th scope="col" style="width: 100px" class="unselectable">Скраћеница</th>
                        <th scope="col" class="unselectable">Назив</th>
                        <th scope="col" style="width: 80px"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        {% if book.id >= 69 and book.id <= 75 %}
                        <tr>
                            <th scope="row" class="unselectable">{{ forloop.counter }}</th>
                            <td class="text-nowrap">{{ book.acronym }}</td>
                            <td>{{ book.title }}</td>
                            <td class="text-center"><a href="{% url 'show_book' book_id=book.id %}" class="btn btn-sm btn-outline-primary"><i class='fas fa-book-medical'></i></a></td>          
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Prophetic Book -->
        <h4 class="mt-4 mb-3 unselectable">Пророчка књига</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-5">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" style="width: 60px" class="unselectable">Бр.</th>
                        <th scope="col" style="width: 100px" class="unselectable">Скраћеница</th>
                        <th scope="col" class="unselectable">Назив</th>
                        <th scope="col" style="width: 80px"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        {% if book.id == 76 %}
                        <tr>
                            <th scope="row" class="unselectable">{{ forloop.counter }}</th>
                            <td class="text-nowrap">{{ book.acronym }}</td>
                            <td>{{ book.title }}</td>
                            <td class="text-center"><a href="{% url 'show_book' book_id=book.id %}" class="btn btn-sm btn-outline-primary"><i class='fas fa-book-medical'></i></a></td>          
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('bookSearch');
    
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        let previousSection = null;
        let previousSubsection = null;
        let hasVisibleContentInSection = false;
        let hasVisibleContentInSubsection = false;
        
        // Show everything if search is empty
        if (!searchTerm) {
            document.querySelectorAll('.bible-table-container .table-responsive, .bible-table-container h3, .bible-table-container h4').forEach(el => {
                el.style.display = '';
            });
            document.querySelectorAll('.bible-table-container table thead, .bible-table-container table tbody tr').forEach(el => {
                el.style.display = '';
            });
            return;
        }
        
        // Process all tables
        document.querySelectorAll('.bible-table-container .table-responsive').forEach(tableContainer => {
            const table = tableContainer.querySelector('table');
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');
            const rows = tbody.querySelectorAll('tr');
            let hasVisibleRows = false;
            
            // Filter rows
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                    hasVisibleRows = true;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Toggle table header and container
            thead.style.display = hasVisibleRows ? '' : 'none';
            tableContainer.style.display = hasVisibleRows ? '' : 'none';
            
            // Track subsection visibility
            const currentSubsection = tableContainer.previousElementSibling;
            if (currentSubsection && currentSubsection.tagName === 'H4') {
                if (hasVisibleRows) {
                    currentSubsection.style.display = '';
                    hasVisibleContentInSubsection = true;
                } else if (currentSubsection !== previousSubsection) {
                    currentSubsection.style.display = 'none';
                }
                previousSubsection = currentSubsection;
            }
            
            // Track section visibility
            const currentSection = currentSubsection ? 
                currentSubsection.previousElementSibling : 
                tableContainer.previousElementSibling;
                
            if (currentSection && currentSection.tagName === 'H3') {
                if (currentSection !== previousSection) {
                    if (previousSection && !hasVisibleContentInSection) {
                        previousSection.style.display = 'none';
                    }
                    previousSection = currentSection;
                    hasVisibleContentInSection = false;
                }
                if (hasVisibleRows) {
                    hasVisibleContentInSection = true;
                }
            }
        });
        
        // Hide last section if empty
        if (previousSection && !hasVisibleContentInSection) {
            previousSection.style.display = 'none';
        }
    });
});
</script>

<style>
    /* Smooth transitions for better UX */
    .table-responsive, h3, h4 {
        transition: all 0.3s ease;
    }
    
    /* Make search bar more prominent */
    #bookSearch {
        padding: 12px;
        font-size: 1.1rem;
    }
    
    /* Adjust spacing when filtered */
    .bible-table-container > h3:first-child {
        margin-top: 1rem !important;
    }
</style>

    
    {% endblock %}